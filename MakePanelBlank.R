#!/usr/bin/env Rscript

require(docopt)
require(methods)

"
Usage:
MakePanelBlank.R (-h | --help | --version)
MakePanelBlank.R DIR

Description:   This script generates a blank panel file based on a directory of FCS files
Options:
--version       Show the current version.

Arguments:

DIR    Provide directory for cytools.args.Rdata to be found, automatically generated by invoking cyttools.R
" -> doc


args <- docopt(doc)

RESULTS_DIR <- args$DIR

cat("\nLoading arguments from", args$DIR, "\n")

load(paste(RESULTS_DIR, "cyttools.args.Rdata", sep = ""))

library(flowCore)
library(cytofCore)
library(flowVS)
library(flowType)
library(tidyverse)
library(reshape2)

panelColnames <- c("name", "desc", "range", "minRange", "maxRange", "Ignore", "Lineage", "Functional", "Barcode", "Viability", "EventDiscrimination", "EQBEADS")

dir <- args$DIR # grabs directory from initial cyttools call
file <- list.files(dir ,pattern='.fcs$', full=TRUE) # captures all FCS files in the directory
flowSet <- read.flowSet(file, transformation = F) # reads in files as flowSet, required for flowType

panel <- as.data.frame(pData(parameters(flowSet[[1]])))
panelBlank <- panel

for ( i in c((ncol(panel)+1):length(panelColnames))){
  panelBlank <- cbind(panelBlank, rep(0, nrow(panelBlank)))
}

colnames(panelBlank) <- panelColnames

panelFile <- paste(RESULTS_DIR, "panelFile.txt", sep = "")

write.table(panelBlank, file = panelFile, sep = "\t", quote = F, row.names = F)
